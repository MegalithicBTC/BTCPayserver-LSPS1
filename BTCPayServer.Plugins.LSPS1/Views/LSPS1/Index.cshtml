@using BTCPayServer.Abstractions.Extensions
@using BTCPayServer.Plugins.LSPS1.Views
@using Microsoft.AspNetCore.Antiforgery
@inject IAntiforgery AntiXsrf
@inject BTCPayServer.Security.ContentSecurityPolicies csp
@model BTCPayServer.Plugins.LSPS1.Controllers.LSPS1Controller.PluginPageViewModel

@{
    ViewData.SetActivePage(PluginNavPages.Index, "Get Lightning Channel");
    var xsrf = AntiXsrf.GetAndStoreTokens(Context).RequestToken;
}

<h1>Enable Inbound Lightning Payments</h1>

<div class="content mb-5">
    <p>Get a Lightning channel with inbound capacity so you can receive payments.</p>
</div>

<!-- React root element -->
<div id="lsps1-root"></div>

<!-- Hidden data needed for JavaScript -->
<input type="hidden" id="store-id" value="@Model.StoreId" />
<input type="hidden" id="request-verification-token" value="@xsrf" />
<input type="hidden" id="is-connected" value="@Model.ConnectionSuccessful.ToString().ToLower()" />
<input type="hidden" id="connection-message" value="@Model.ConnectionMessage" />
<input type="hidden" id="selected-lsp-slug" value="@Model.SelectedLspSlug" />
<input type="hidden" id="connected-lsp-name" value="@(Model.ConnectedLsp?.Name ?? "")" />
<input type="hidden" id="lsp-info-data" value="@Model.LspInfoJson" />

<!-- Hidden div containing the node's public key -->
<div id="node-public-key-value" style="display: none;">@Model.NodePublicKey</div>

<!-- Available LSPs data -->
<div id="available-lsps" class="d-none">
    @foreach (var lsp in Model.AvailableLsps)
    {
        <div 
            data-lsp-slug="@lsp.Slug" 
            data-lsp-name="@lsp.Name"
            data-lsp-selected="@(lsp.Slug == Model.SelectedLspSlug ? "true" : "false")">
        </div>
    }
</div>

<!-- Include React libraries -->
<script src="~/Resources/js/vendor/react.production.min.js" asp-append-version="true"></script>
<script src="~/Resources/js/vendor/react-dom.production.min.js" asp-append-version="true"></script>

<!-- Services -->
<script src="~/Resources/js/services/lspManager.js" asp-append-version="true"></script>
<script src="~/Resources/js/services/channelOrderManager.js" asp-append-version="true"></script>

<!-- Components -->
<script src="~/Resources/js/components/LoadingSpinner.js" asp-append-version="true"></script>
<script src="~/Resources/js/components/ChannelSizeSlider.js" asp-append-version="true"></script>
<script src="~/Resources/js/components/OrderResult.js" asp-append-version="true"></script>
<script src="~/Resources/js/components/ChannelConfiguration.js" asp-append-version="true"></script>
<script src="~/Resources/js/components/ConnectionFooter.js" asp-append-version="true"></script>
<script src="~/Resources/js/components/LSPS1App.js" asp-append-version="true"></script>

<!-- Main initialization script -->
<script src="~/Resources/js/lsps1.js" asp-append-version="true"></script>